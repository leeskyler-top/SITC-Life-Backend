<?php

namespace App\Http\Controllers;

use App\Models\User;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;
use Illuminate\Support\Facades\File;
use Illuminate\Support\Facades\Response;
use Symfony\Component\HttpKernel\Exception\NotFoundHttpException;

class FileController extends Controller
{
    function myAvatar()
    {
        $user = Auth::user();
        $default_img = "iVBORw0KGgoAAAANSUhEUgAAAF4AAAB8CAIAAABv1JAEAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyBpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBXaW5kb3dzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOkE2NzZGQTgxNTAwMjExRTNCMTNGQTk1NTkzMzAzNDYyIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOkE2NzZGQTgyNTAwMjExRTNCMTNGQTk1NTkzMzAzNDYyIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6QTY3NkZBN0Y1MDAyMTFFM0IxM0ZBOTU1OTMzMDM0NjIiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6QTY3NkZBODA1MDAyMTFFM0IxM0ZBOTU1OTMzMDM0NjIiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz7r3y0KAAAKcUlEQVR42uydi1oaORTH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";
        if (!$user->avatar_url || !File::exists(public_path('images/avatar/' . $user->avatar_url))) {
            $response = Response::make(base64_decode($default_img), 200);
            $response->header('Content-Type', 'image/png');
            return $response;
        }

        return response()->file(public_path('images/avatar' . $user->avatar_url), ['Content-Type' => mime_content_type(public_path('images/avatar' . $user->avatar_url))]);
    }

    function avatar($user_id)
    {
        $user = User::find($user_id);
        if (!$user) {
            throw new NotFoundHttpException();
        }
        $default_img = "iVBORw0KGgoAAAANSUhEUgAAAF4AAAB8CAIAAABv1JAEAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyBpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBXaW5kb3dzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOkE2NzZGQTgxNTAwMjExRTNCMTNGQTk1NTkzMzAzNDYyIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOkE2NzZGQTgyNTAwMjExRTNCMTNGQTk1NTkzMzAzNDYyIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6QTY3NkZBN0Y1MDAyMTFFM0IxM0ZBOTU1OTMzMDM0NjIiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6QTY3NkZBODA1MDAyMTFFM0IxM0ZBOTU1OTMzMDM0NjIiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz7r3y0KAAAKcUlEQVR42uydi1oaORTH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";
        if (!$user->avatar_url || !File::exists(public_path('files/')  . $user->avatar_url )) {
            $response = Response::make(base64_decode($default_img), 200);
            $response->header('Content-Type', 'image/png');
            return $response;
        }
        return response()->file(public_path("files/") . $user->avatar_url, ['Content-Type' => mime_content_type(public_path('files/' . $user->avatar_url))]);
    }
}
